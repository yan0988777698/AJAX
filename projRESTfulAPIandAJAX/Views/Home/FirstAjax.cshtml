@{
    ViewData["Title"] = "FirstAjax";
}

<h1>FirstAjax</h1>
<img id="img1" src="~/Images/Hourglass.gif" style="display:none" />
<button class="btn btn-primary" id="btn1">Go Ajax</button>
<button class="btn btn-danger" id="btn2">Stop Ajax</button>

<div id="div1"></div>

@section Scripts {
    <script>
        let btn1 = document.querySelector("#btn1")
        let btn2 = document.querySelector("#btn2")
        let div = document.querySelector("#div1")
        let img = document.querySelector("#img1")
        let abortController;
        // btn.addEventListener("click",()=>{
        //     fetch('@Url.Content("~/Api/ReturnContent")')
        //     .then(response=> response.text())
        //     .then(data=> div.innerHTML = data)
        // })
        btn2.addEventListener("click", () => {
            abortController.abort()
        })
        btn1.addEventListener("click", async () => {
            try {
                img.style.display = "inline"
                btn1.setAttribute("disabled","disabled")

                abortController = new AbortController()
                const signal = abortController.signal

                let promise = await fetch('@Url.Content("~/Api/ReturnContent")', {signal})
                if (!promise.ok)
                    throw new Error(`${promise.status}`)
                let data = await promise.text();

                div.innerHTML = `<h2>${data}</h2>`;
            } catch (error) {
                div.innerHTML = `<h2>${error}</h2>`;
            } finally {
                img.style.display = "none"
                btn1.removeAttribute("disabled")
            }

        })

    </script>

}
@section Styles {

}